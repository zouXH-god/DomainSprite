# ðŸŒŸ DomainSprite README ðŸŽ®

**DomainSprite** æ˜¯ä¸€ä¸ª DNS è®°å½•ç®¡ç†å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„ç®¡ç†å¤šå¹³å°çš„ DNS è®°å½•ï¼Œå¹¶ä¸”é›†æˆ SSL è¯ä¹¦ç”³è¯·ï¼Œå¯ä»¥ç®€å•çš„ä¸ºè‡ªå·±çš„åŸŸåæˆ–å…¶ä»–åŸŸåè¿›è¡Œé€šé…ç¬¦è¯ä¹¦ç”³è¯·

## ðŸ° åŠŸèƒ½äº®ç‚¹

- **å¤šäº‘æ”¯æŒ**ï¼šä½ å¯ä»¥åŒæ—¶ç®¡ç† **é˜¿é‡Œäº‘**ã€**è…¾è®¯äº‘** å’Œ **Cloudflare** è´¦æˆ·ï¼Œå°±åƒæ‹¥æœ‰å¤šä¸ªé­”æ³•å·è½´ï¼Œéšæ—¶å‘¼å”¤ä½ çš„ DNS è®°å½•ï¼ðŸŒ
- **å¿«é€Ÿè¯ä¹¦ç”³è¯·**ï¼šä»…éœ€ä¸€ä¸ªè¯·æ±‚ï¼Œå°±èƒ½ä¸€é”®ç”³è¯·åŸŸåçš„é€šé…ç¬¦è¯ä¹¦ï¼ðŸ“œ
- **ä¸é™åˆ¶çš„è¯ä¹¦åŸŸå**ï¼šä¸è®ºæ˜¯è‡ªå·±çš„åŸŸåè¿˜æ˜¯å…¶ä»–äººçš„åŸŸåï¼Œä½ éƒ½èƒ½è½»æ¾åœ°ç”³è¯·é€šé…ç¬¦è¯ä¹¦ï¼
- **å¿«é€Ÿé…ç½®**ï¼šåªéœ€ç®€å•é…ç½®æ–‡ä»¶ï¼Œå°±èƒ½ä¸€é”®å¼€å¯é­”æ³•ã€‚âœ¨
- **å¿«æ· API**ï¼šé€šè¿‡å¼ºå¤§çš„ API æŽ¥å£ï¼Œç®¡ç†ä½ çš„åŸŸåå’Œè®°å½•ï¼Œè½»æ¾å¦‚æŽŒä¸­å®ï¼âš¡
- **å¿«é€ŸDDNS**ï¼šé€šè¿‡ç®€å•çš„ APIï¼Œä½ å¯ä»¥è½»æ¾åœ°åˆ›å»ºä¸€ä¸ªåŸŸåè§£æžTokenã€‚é€šè¿‡è¿™ä¸ªTokenï¼Œä½ å¯ä»¥è½»æ¾çš„åœ¨å…¶ä»–æœåŠ¡å™¨ä¸ŠåŠ¨æ€çš„æ›´æ–°ä½ çš„åŸŸåè§£æžï¼

## TODO

- [ ] æ·»åŠ æ›´å¤šäº‘å¹³å°æ”¯æŒ
- [x] ä¿®æ”¹å½“å‰çš„å•åŸŸåSSlè¯ä¹¦ç”³è¯·ä¸ºå¤šåŸŸåé€šé…ç¬¦æ¨¡å¼
- [ ] ä¿®æ”¹SSlè¯ä¹¦ç”³è¯·ä¸ºé˜Ÿåˆ—æ¨¡å¼è¿›è¡Œ
- [ ] æ·»åŠ webç®¡ç†é¢æ¿
- [ ] æ·»åŠ è¯ä¹¦å¿«æ·ä¸‹è½½æŽ¥å£æ–¹ä¾¿æœåŠ¡å™¨è¿›è¡ŒåŠ¨æ€æ›´æ–°
- [ ] æ·»åŠ è¯ä¹¦è‡ªåŠ¨ç»­æœŸ

## ðŸš€ å¿«é€Ÿå¼€å§‹

### 1. ä¸‹è½½ç¨‹åºåŒ…

> å‰å¾€ `release` èŽ·å–ç¨‹åºåŒ…ï¼Œä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ç¨‹åºåŒ…ã€‚

### 2. é…ç½®æ–‡ä»¶

> å¯¹ `config.yaml` è¿›è¡Œé…ç½®ä¿®æ”¹

**baseConfig**ï¼š åŸºç¡€çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç«¯å£å·ã€åŸŸåã€å¯†é’¥ç­‰

```toml
[baseConfig]
Host = "127.0.0.1"
Port = "2485"
AccessKeyId = "ä½ çš„é­”æ³•é’¥åŒ™ID"
AccessKeySecret = "ä½ çš„é­”æ³•å¯†é’¥"
```

**certificateConfig**ï¼š SSLè¯ä¹¦ç”³è¯·é…ç½®ï¼ŒåŒ…æ‹¬é‚®ç®±åˆ—è¡¨ã€æœ€å¤§ç”³è¯·æ•°é‡ã€è¯ä¹¦çš„ä¿å­˜è·¯å¾„ã€ä½¿ç”¨çš„è´¦å·ç­‰

```toml
[certificateConfig]
EmailList=["email@mail.com", "email2@mail.com"]  # ç”³è¯·è¯ä¹¦ä½¿ç”¨çš„é‚®ç®±åˆ—è¡¨
MaxRequest=20  # å•é‚®ç®±å•æ¬¡æœ€å¤§ç”³è¯·è¯ä¹¦æ•°é‡
SavePath="./certificateData/"  # è¯ä¹¦ä¿å­˜è·¯å¾„
# ç¬¬ä¸‰æ–¹åŸŸåç”³è¯·ä½¿ç”¨çš„è´¦å·ä¸ŽåŸŸå
ApplyAccount="account1"  # è¦ä½¿ç”¨çš„è´¦æˆ·
ApplyDomainId=""  # è¦ä½¿ç”¨çš„åŸŸåid
ApplyDomainName=""  # è¦ä½¿ç”¨çš„åŸŸå
```

**fastConfig**ï¼š å¿«é€Ÿè¯·æ±‚é…ç½®ï¼Œæ”¹éƒ¨åˆ†ç”¨äºŽå¿«é€Ÿæ›´æ–°è®°å½•æŽ¥å£ã€‚åªéœ€è¦ä¸€ä¸ªTokenï¼Œå°±èƒ½è½»æ¾çš„æ›´æ–°ä½ çš„è®°å½•ï¼

```toml
[fastConfig]
UseAccount = "account1"  # ä½¿ç”¨çš„è´¦æˆ·
DomainId = ""            # è¦ä½¿ç”¨çš„åŸŸåID
DomainName = ""          # è¦ä½¿ç”¨çš„åŸŸå
NameStrata = "server_a_" # è§£æžå‰ç¼€
IdLength = 5             # è§£æžIDçš„é•¿åº¦
StartId = 1              # è§£æžèµ·å§‹ID
DataPath = "./data/"     # æ•°æ®ä¿å­˜ç›®å½•
AccessSalt = "ä½ çš„å¿«é€Ÿè¯·æ±‚ç›"
```

### 3. è´¦æˆ·ç®¡ç†

ä½ å¯ä»¥åœ¨æ–‡ä»¶ä¸­è®¾ç½®å¤šä¸ªè´¦æˆ·ï¼Œåªè¦æŒ‰ç…§å½“å‰æ ¼å¼ç»§ç»­æ·»åŠ å³å¯

```toml
[[account]]
Name = "account1"
Type = "Ali"
AccessKeyId = "é˜¿é‡Œäº‘AKID"
AccessKeySecret = "é˜¿é‡Œäº‘AKSecret"

[[account]]
Name = "account2"
Type = "Cloudflare"
AccessKeyId = "Cloudflareè´¦å·ID"
AccessKeySecret = "Cloudflareé‚®ç®±"

[[account]]
Name = "account3"
Type = "Tencent"
AccessKeyId = "è…¾è®¯äº‘AKID"
AccessKeySecret = "è…¾è®¯äº‘AKSecret"
```

### 5. è¿è¡Œ

- Linux ç³»ç»Ÿæ‰§è¡Œ `chmod +x ./DomainSprite* && ./DomainSprite*`
- Windows ç³»ç»ŸåŒå‡» `DomainSprite.exe` è¿è¡Œå³å¯

### 4. API ä½¿ç”¨ - é­”æ³•æ“ä½œï¼

> #### [APIæ–‡æ¡£](https://50swcphpjw.apifox.cn) <- åœ¨è¿™å„¿

é€šè¿‡ä¸‹é¢çš„ APIï¼Œä½ å¯ä»¥åƒå¬å”¤é­”æ³•ä¸€æ ·ï¼Œè½»æ¾æ“ä½œä½ çš„ DNS è®°å½•å’ŒåŸŸåï¼š

#### åŸŸåç®¡ç†

- **èŽ·å–è´¦æˆ·åˆ—è¡¨**  
  `GET /api/accounts`  
  èŽ·å–æ‰€æœ‰è´¦æˆ·çš„åˆ—è¡¨ã€‚

- **èŽ·å–è´¦æˆ·åŸŸååˆ—è¡¨**  
  `GET /api/:accountName/domains`  
  èŽ·å–æŒ‡å®šè´¦æˆ·çš„åŸŸååˆ—è¡¨ã€‚

- **èŽ·å–è´¦æˆ·çš„ DNS è®°å½•åˆ—è¡¨**  
  `GET /api/:accountName/records`  
  èŽ·å–æŒ‡å®šè´¦æˆ·çš„ DNS è®°å½•åˆ—è¡¨ã€‚

- **æ·»åŠ  DNS è®°å½•**  
  `POST /api/:accountName/record`  
  æ·»åŠ ä¸€æ¡æ–°çš„ DNS è®°å½•ã€‚

- **æ›´æ–° DNS è®°å½•**  
  `PUT /api/:accountName/record`  
  ä¿®æ”¹ä¸€æ¡ DNS è®°å½•ã€‚

- **åˆ é™¤ DNS è®°å½•**  
  `DELETE /api/:accountName/record`  
  åˆ é™¤ä¸€æ¡ DNS è®°å½•ã€‚

- **ä¿®æ”¹ DNS è®°å½•çŠ¶æ€**  
  `PUT /api/:accountName/record/status`  
  å¯ç”¨æˆ–ç¦ç”¨ DNS è®°å½•ã€‚

- **ä¸€é”®ç”³è¯·é€šé…ç¬¦è¯ä¹¦**  
  `POST /api/:accountName/certificate`  
  ä¸ºæŒ‡å®šåŸŸåç”³è¯·é€šé…ç¬¦è¯ä¹¦ã€‚

#### å¿«é€Ÿè¯·æ±‚

å¦‚æžœä½ éœ€è¦å¿«é€Ÿæ›´æ–°è®°å½•ï¼Œåªéœ€åŠ¨åŠ¨æ‰‹æŒ‡ï¼š

- **åˆ›å»º A è®°å½•å¹¶è¿”å›ž Token**  
  `GET /fast/ip2a`  
  åˆ›å»ºä¸€æ¡ A è®°å½•å¹¶è¿”å›žå¿«é€ŸéªŒè¯ Tokenã€‚

- **ä½¿ç”¨ Token æ›´æ–°è®°å½•**  
  `GET /fast/updateRecord`  
  æ ¹æ® Token æ›´æ–° DNS è®°å½•ã€‚

## ðŸ”’ é‰´æƒè¯´æ˜Ž - é­”æ³•é’¥åŒ™ðŸ”‘

ä¸ºäº†ä¿æŠ¤ä½ çš„é­”æ³•ï¼Œæ‰€æœ‰ API è¯·æ±‚éƒ½éœ€è¦è¿›è¡Œ **é‰´æƒ**ã€‚å½“ä½ å‘é€è¯·æ±‚æ—¶ï¼Œéœ€è¦ä¼ é€’ **AccessKeyId** å’Œ **AccessKeySecret**ï¼Œè¿™æ˜¯ä½ çš„é­”æ³•é’¥åŒ™ï¼âš”ï¸

### API é‰´æƒé€»è¾‘

- **AccessKeyId** å’Œ **AccessKeySecret** éœ€è¦åŒ¹é…ç³»ç»Ÿé…ç½®ä¸­çš„å€¼ã€‚å¦‚æžœè¿™äº›å€¼ä¸ºç©ºï¼Œæˆ–è€…ä¸åŒ¹é…ï¼Œå°†ä¼šé˜»æ­¢è¯·æ±‚ç»§ç»­è¿›è¡Œã€‚
- **FastAuthentication**ï¼šå¯¹äºŽå¿«é€Ÿè¯·æ±‚ï¼Œéœ€è¦æä¾› **AccessSalt** è¿›è¡ŒéªŒè¯ã€‚

#### é‰´æƒä»£ç å‚è€ƒ

```go
func ApiAuthentication(c *gin.Context) {
	accessKeyId := c.GetHeader("AccessKeyId")
	accessKeySecret := c.GetHeader("AccessKeySecret")
	if accessKeyId == "" || accessKeySecret == "" {
		c.JSON(400, gin.H{
			"message": "AccessKeyId æˆ– AccessKeySecret ä¸ºç©º",
		})
		c.Abort()
		return
	}
	if accessKeyId != models.AccountConfig.BaseConfig.AccessKeyId || accessKeySecret != models.AccountConfig.BaseConfig.AccessKeySecret {
		c.JSON(400, gin.H{
			"message": "AccessKeyId æˆ– AccessKeySecret é”™è¯¯",
		})
		c.Abort()
		return
	}
}

func FastAuthentication(c *gin.Context) {
	accessSalt := c.GetHeader("AccessSalt")
	if accessSalt == "" || accessSalt != models.AccountConfig.FastConfig.AccessSalt {
		c.JSON(400, gin.H{
			"message": "AccessSalt é”™è¯¯",
		})
		c.Abort()
		return
	}
}
```

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -H "AccessKeyId: ä½ çš„é­”æ³•é’¥åŒ™ID" -H "AccessKeySecret: ä½ çš„é­”æ³•å¯†é’¥" http://127.0.0.1:2485/api/accounts
```

## ðŸ† æœ€åŽï¼Œåˆ«å¿˜äº†...

**DomainSprite** æ˜¯ä½ ç®¡ç† DNS è®°å½•çš„æœ€ä½³ä¼™ä¼´ï¼ðŸ’« ä¸ç®¡ä½ æ˜¯æ™®é€šç”¨æˆ·ï¼Œè¿˜æ˜¯äº‘æœåŠ¡ç®¡ç†é«˜æ‰‹ï¼Œè¿™ä¸ªå·¥å…·éƒ½èƒ½å¸®ä½ å¿«é€Ÿè§£å†³é—®é¢˜ã€‚

æ¬¢è¿Žå„è·¯å¤§ä½¬ä¸º **DomainSprite** åšå‡ºè´¡çŒ®ï¼Œä¸€èµ·åˆ›é€ æ›´å¤šç¥žå¥‡çš„é­”æ³•ï¼

```plaintext
           ðŸŒ¸
    â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£€â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
       ðŸŒ¼  (ï½¡â€¢Ì€á´—â€¢Ìï½¡) ðŸŽ®       å¿«é€Ÿç®¡ç†ä½ çš„ DNSï¼Œä¿æŠ¤ä½ çš„è™šæ‹Ÿä¸–ç•Œ
           ðŸŒ»â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
``` 

äº«å—é­”æ³•ï¼Œäº«å—ä¸–ç•Œï¼ðŸŒˆ