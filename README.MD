# ğŸŒŸ DomainSprite README ğŸ®

æ¬¢è¿æ¥åˆ° **DomainSprite** çš„é­”æ³•ä¸–ç•Œï¼ğŸŒ¸âœ¨

åœ¨è¿™ä¸ªä¸–ç•Œä¸­ï¼Œä½ å°†èƒ½è½»æ¾ç®¡ç†ä½ çš„ DNS è®°å½•ï¼Œå¿«é€Ÿç®¡ç†å¤šä¸ªäº‘æœåŠ¡è´¦æˆ·ï¼Œç”šè‡³å°†åŸŸåå’Œè®°å½•åƒé­”æ³•ä¸€æ ·è‡ªç”±æ“æ§ï¼ğŸ©ğŸ”®

å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢å¦‚ä½•ä½¿ç”¨è¿™ä¸ªè¶…å¼ºçš„å·¥å…·å§ï¼ğŸš€

## ğŸ° åŠŸèƒ½äº®ç‚¹

- **å¤šäº‘æ”¯æŒ**ï¼šä½ å¯ä»¥åŒæ—¶ç®¡ç† **é˜¿é‡Œäº‘**ã€**è…¾è®¯äº‘** å’Œ **Cloudflare** è´¦æˆ·ï¼Œå°±åƒæ‹¥æœ‰å¤šä¸ªé­”æ³•å·è½´ï¼Œéšæ—¶å‘¼å”¤ä½ çš„ DNS è®°å½•ï¼ğŸŒ
- **å¿«é€Ÿé…ç½®**ï¼šåªéœ€ç®€å•é…ç½®æ–‡ä»¶ï¼Œå°±èƒ½ä¸€é”®å¼€å¯é­”æ³•ã€‚ğŸ“œâœ¨
- **å¿«æ· API**ï¼šé€šè¿‡å¼ºå¤§çš„ API æ¥å£ï¼Œç®¡ç†ä½ çš„åŸŸåå’Œè®°å½•ï¼Œè½»æ¾å¦‚æŒä¸­å®ï¼âš¡
- **æ— ç¼è¡”æ¥**: è½»æ¾ç®¡ç†ä½ çš„ DNS è®°å½•ï¼Œä¸å¤šä¸ªäº‘æœåŠ¡è´¦æˆ·æ— ç¼è¡”æ¥ï¼Œè®©ä½ åƒé­”æ³•å¸ˆä¸€æ ·ï¼Œè½»æ¾ç®¡ç†ä½ çš„ DNS è®°å½•ï¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

é¦–å…ˆï¼Œè¯·ç¡®ä¿ä½ å·²ç»å®‰è£…äº† Go å’Œ Ginï¼Œå¼€å¯ä½ çš„é­”æ³•æ—…ç¨‹ï¼š

```bash
go get github.com/gin-gonic/gin
```

### 2. é…ç½®æ–‡ä»¶

> å¤åˆ¶ `config.yaml.example` ä¸º `config.yaml` è¿›è¡Œé…ç½®ä¿®æ”¹

æ‰“å¼€ `baseConfig` å’Œ `fastConfig` éƒ¨åˆ†ï¼Œé…ç½®ä½ çš„é­”æ³•é˜µï¼š

```toml
[baseConfig]
Host = "127.0.0.1"
Port = "2485"
AccessKeyId = "ä½ çš„é­”æ³•é’¥åŒ™ID"
AccessKeySecret = "ä½ çš„é­”æ³•å¯†é’¥"
```

åœ¨ `fastConfig` éƒ¨åˆ†ï¼Œè®¾ç½®è´¦æˆ·å’Œæ•°æ®è·¯å¾„ç­‰ä¿¡æ¯ï¼š

```toml
[fastConfig]
UseAccount = "account1"  # ä½¿ç”¨çš„è´¦æˆ·
DomainId = ""            # è¦ä½¿ç”¨çš„åŸŸåID
DomainName = ""          # è¦ä½¿ç”¨çš„åŸŸå
NameStrata = "server_a_" # è§£æå‰ç¼€
IdLength = 5             # è§£æIDçš„é•¿åº¦
StartId = 1              # è§£æèµ·å§‹ID
DataPath = "./data/"     # æ•°æ®ä¿å­˜ç›®å½•
AccessSalt = "ä½ çš„å¿«é€Ÿè¯·æ±‚ç›"
```

### 3. è´¦æˆ·ç®¡ç†

ä½ å¯ä»¥åœ¨æ–‡ä»¶ä¸­è®¾ç½®å¤šä¸ªè´¦æˆ·ï¼Œåƒæ”¶é›†è§’è‰²å¡ä¸€æ ·ï¼ğŸŒŸ

```toml
[[account]]
Name = "account1"
Type = "Ali"
AccessKeyId = "é˜¿é‡Œäº‘AKID"
AccessKeySecret = "é˜¿é‡Œäº‘AKSecret"

[[account]]
Name = "account2"
Type = "Cloudflare"
AccessKeyId = "Cloudflareè´¦å·ID"
AccessKeySecret = "Cloudflareé‚®ç®±"

[[account]]
Name = "account3"
Type = "Tencent"
AccessKeyId = "è…¾è®¯äº‘AKID"
AccessKeySecret = "è…¾è®¯äº‘AKSecret"
```

### 4. API ä½¿ç”¨ - é­”æ³•æ“ä½œï¼

é€šè¿‡ä¸‹é¢çš„ APIï¼Œä½ å¯ä»¥åƒå¬å”¤é­”æ³•ä¸€æ ·ï¼Œè½»æ¾æ“ä½œä½ çš„ DNS è®°å½•å’ŒåŸŸåï¼š

#### åŸŸåç®¡ç†

- **è·å–è´¦æˆ·åˆ—è¡¨**  
  `GET /api/accounts`  
  è·å–æ‰€æœ‰è´¦æˆ·çš„åˆ—è¡¨ã€‚

- **è·å–è´¦æˆ·åŸŸååˆ—è¡¨**  
  `GET /api/:accountName/domains`  
  è·å–æŒ‡å®šè´¦æˆ·çš„åŸŸååˆ—è¡¨ã€‚

- **è·å–è´¦æˆ·çš„ DNS è®°å½•åˆ—è¡¨**  
  `GET /api/:accountName/records`  
  è·å–æŒ‡å®šè´¦æˆ·çš„ DNS è®°å½•åˆ—è¡¨ã€‚

- **æ·»åŠ  DNS è®°å½•**  
  `POST /api/:accountName/record`  
  æ·»åŠ ä¸€æ¡æ–°çš„ DNS è®°å½•ã€‚

- **æ›´æ–° DNS è®°å½•**  
  `PUT /api/:accountName/record`  
  ä¿®æ”¹ä¸€æ¡ DNS è®°å½•ã€‚

- **åˆ é™¤ DNS è®°å½•**  
  `DELETE /api/:accountName/record`  
  åˆ é™¤ä¸€æ¡ DNS è®°å½•ã€‚

- **ä¿®æ”¹ DNS è®°å½•çŠ¶æ€**  
  `PUT /api/:accountName/record/status`  
  å¯ç”¨æˆ–ç¦ç”¨ DNS è®°å½•ã€‚

#### å¿«é€Ÿè¯·æ±‚

å¦‚æœä½ éœ€è¦å¿«é€Ÿæ›´æ–°è®°å½•ï¼Œåªéœ€åŠ¨åŠ¨æ‰‹æŒ‡ï¼š

- **åˆ›å»º A è®°å½•å¹¶è¿”å› Token**  
  `GET /fast/ip2a`  
  åˆ›å»ºä¸€æ¡ A è®°å½•å¹¶è¿”å›å¿«é€ŸéªŒè¯ Tokenã€‚

- **ä½¿ç”¨ Token æ›´æ–°è®°å½•**  
  `GET /fast/updateRecord`  
  æ ¹æ® Token æ›´æ–° DNS è®°å½•ã€‚

## ğŸ”’ é‰´æƒè¯´æ˜ - é­”æ³•é’¥åŒ™ğŸ”‘

ä¸ºäº†ä¿æŠ¤ä½ çš„é­”æ³•ï¼Œæ‰€æœ‰ API è¯·æ±‚éƒ½éœ€è¦è¿›è¡Œ **é‰´æƒ**ã€‚å½“ä½ å‘é€è¯·æ±‚æ—¶ï¼Œéœ€è¦ä¼ é€’ **AccessKeyId** å’Œ **AccessKeySecret**ï¼Œè¿™æ˜¯ä½ çš„é­”æ³•é’¥åŒ™ï¼âš”ï¸

### API é‰´æƒé€»è¾‘

- **AccessKeyId** å’Œ **AccessKeySecret** éœ€è¦åŒ¹é…ç³»ç»Ÿé…ç½®ä¸­çš„å€¼ã€‚å¦‚æœè¿™äº›å€¼ä¸ºç©ºï¼Œæˆ–è€…ä¸åŒ¹é…ï¼Œå°†ä¼šé˜»æ­¢è¯·æ±‚ç»§ç»­è¿›è¡Œã€‚
- **FastAuthentication**ï¼šå¯¹äºå¿«é€Ÿè¯·æ±‚ï¼Œéœ€è¦æä¾› **AccessSalt** è¿›è¡ŒéªŒè¯ã€‚

#### ç¤ºä¾‹ä»£ç 

```go
func ApiAuthentication(c *gin.Context) {
	accessKeyId := c.GetHeader("AccessKeyId")
	accessKeySecret := c.GetHeader("AccessKeySecret")
	if accessKeyId == "" || accessKeySecret == "" {
		c.JSON(400, gin.H{
			"message": "AccessKeyId æˆ– AccessKeySecret ä¸ºç©º",
		})
		c.Abort()
		return
	}
	if accessKeyId != models.AccountConfig.BaseConfig.AccessKeyId || accessKeySecret != models.AccountConfig.BaseConfig.AccessKeySecret {
		c.JSON(400, gin.H{
			"message": "AccessKeyId æˆ– AccessKeySecret é”™è¯¯",
		})
		c.Abort()
		return
	}
}

func FastAuthentication(c *gin.Context) {
	accessSalt := c.GetHeader("AccessSalt")
	if accessSalt == "" || accessSalt != models.AccountConfig.FastConfig.AccessSalt {
		c.JSON(400, gin.H{
			"message": "AccessSalt é”™è¯¯",
		})
		c.Abort()
		return
	}
}
```

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -H "AccessKeyId: ä½ çš„é­”æ³•é’¥åŒ™ID" -H "AccessKeySecret: ä½ çš„é­”æ³•å¯†é’¥" http://127.0.0.1:2485/api/accounts
```

## ğŸ† æœ€åï¼Œåˆ«å¿˜äº†...

**DomainSprite** æ˜¯ä½ ç®¡ç† DNS è®°å½•çš„æœ€ä½³ä¼™ä¼´ï¼ğŸ’« ä¸ç®¡ä½ æ˜¯æ™®é€šç”¨æˆ·ï¼Œè¿˜æ˜¯äº‘æœåŠ¡ç®¡ç†é«˜æ‰‹ï¼Œè¿™ä¸ªå·¥å…·éƒ½èƒ½å¸®ä½ å¿«é€Ÿè§£å†³é—®é¢˜ã€‚

æ¬¢è¿å„è·¯å¤§ä½¬ä¸º **DomainSprite** åšå‡ºè´¡çŒ®ï¼Œä¸€èµ·åˆ›é€ æ›´å¤šç¥å¥‡çš„é­”æ³•ï¼

```plaintext
           ğŸŒ¸
    â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£€â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
       ğŸŒ¼  (ï½¡â€¢Ì€á´—â€¢Ìï½¡) ğŸ®       å¿«é€Ÿç®¡ç†ä½ çš„ DNSï¼Œä¿æŠ¤ä½ çš„è™šæ‹Ÿä¸–ç•Œ
           ğŸŒ»â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
``` 

äº«å—é­”æ³•ï¼Œäº«å—ä¸–ç•Œï¼ğŸŒˆ